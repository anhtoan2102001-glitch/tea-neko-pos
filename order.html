<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ƒê·∫∑t m√≥n ‚Äì Tea Neko</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
    body {
        margin: 0;
        font-family: system-ui, Arial;
        background: #f3f3f3;
        padding: 20px;
    }

    .box {
        max-width: 480px;
        margin: auto;
        background: white;
        padding: 16px;
        border-radius: 14px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    h2 {
        text-align: center;
        margin-top: 0;
    }

    .menu-item {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #fafafa;
    }

    button {
        padding: 10px;
        width: 100%;
        border: none;
        border-radius: 10px;
        background: #007AFF;
        color: white;
        font-size: 17px;
        margin-top: 14px;
    }

    textarea {
        width: 100%;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #ccc;
        margin-top: 10px;
    }

</style>
</head>
<body>

<div class="box">
    <h2>ƒê·∫∑t m√≥n ‚Äì Tea Neko</h2>

    <div id="tableInfo" style="margin:10px 0; font-size:16px; font-weight:600;"></div>

    <h3>Menu</h3>

    <div id="menuList"></div>

    <textarea id="note" placeholder="Ghi ch√∫ cho qu√°n (N·∫øu c√≥)..."></textarea>

    <button onclick="submitOrder()">G·ª≠i ƒë∆°n</button>

    <p id="status" style="text-align:center; margin-top:15px; color:green;"></p>
</div>

<script>
/* ========== Supabase ========== */
const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co";  
const SUPABASE_KEY = "YOUR_PUBLIC_ANON_KEY";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ========== S·ªë b√†n ========== */
const urlParams = new URLSearchParams(window.location.search);
const tableNo = urlParams.get("table") || "Kh√¥ng x√°c ƒë·ªãnh";
document.getElementById("tableInfo").innerText = "B√†n: " + tableNo;

/* ========== MENU MATCH POS ========== */
const MENU = [
    { name: "Matcha Latte", price: 25000 },
    { name: "Tr√† s·ªØa tr√¢n ch√¢u", price: 30000 },
    { name: "Cacao ƒë√°", price: 22000 },
    { name: "Coffee", price: 25000 },
    { name: "H·ªìng tr√† s·ªØa", price: 28000 },
    { name: "B·∫°c x·ªâu", price: 20000 },
];

let selectedItems = [];

/* Hi·ªÉn th·ªã menu */
function renderMenu() {
    let html = "";
    MENU.forEach((item, i) => {
        html += `
            <div class="menu-item">
                <div>
                    <b>${item.name}</b><br>
                    ${item.price.toLocaleString()} VND
                </div>
                <button style="width:90px; background:#28a745;" onclick="addItem(${i})">+ Ch·ªçn</button>
            </div>
        `;
    });
    document.getElementById("menuList").innerHTML = html;
}
renderMenu();

/* Ch·ªçn m√≥n */
function addItem(i) {
    selectedItems.push({
        name: MENU[i].name,
        price: MENU[i].price,
        qty: 1
    });
    alert("ƒê√£ th√™m: " + MENU[i].name);
}

/* G·ª≠i order l√™n Supabase */
async function submitOrder() {
    if (selectedItems.length === 0) {
        alert("B·∫°n ch∆∞a ch·ªçn m√≥n!");
        return;
    }

    const note = document.getElementById("note").value || "";

    const { error } = await sb
        .from("web_orders")
        .insert({
            table_no: String(tableNo),
            items: selectedItems,
            note: note,
            status: "pending"
        });

    if (error) {
        alert("L·ªói g·ª≠i ƒë∆°n!");
        console.log(error);
    } else {
        document.getElementById("status").innerText = "G·ª≠i ƒë∆°n th√†nh c√¥ng! üéâ";
        selectedItems = [];
    }
}
</script>
</body>
</html>
